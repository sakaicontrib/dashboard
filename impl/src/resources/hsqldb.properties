# HSQL SQL Statements

create.AvailabilityCheck.table = create table dash_availability_check \
( id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY, entity_ref varchar(265) not null, \
entity_type_id varchar(255) not null, scheduled_time timestamp(6) not null); \
create unique index dash_availability_check_idx on dash_availability_check(entity_ref, scheduled_time); \
create index dash_availability_check_time_idx on dash_availability_check(scheduled_time)

create.CalendarItem.table = create table dash_calendar_item ( id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY, \
calendar_time timestamp(6) not null, calendar_time_label_key varchar(40), title varchar(255) not null, \
entity_ref varchar(265) not null, entity_type bigint not null, subtype varchar(40), context_id bigint not null, \
repeating_event_id bigint, sequence_num integer); \
create index dash_calendar_time_idx on dash_calendar_item (calendar_time); \
create unique index dash_calendar_entity_label_idx on dash_calendar_item (entity_ref, calendar_time_label_key, sequence_num); \
create index dash_calendar_entity_idx on dash_calendar_item (entity_ref); \
create sequence dash_id_seq

create.CalendarLink.table = create table dash_calendar_link ( id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY, \
person_id bigint not null, context_id bigint not null, item_id bigint not null, hidden bit default 0, \
sticky bit default 0, unique (person_id, context_id, item_id)); \
create index dash_calendar_link_idx on dash_calendar_link (person_id, context_id, item_id, hidden, sticky)

create.Context.table = create table dash_context ( id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY, context_id varchar(255) not null, \
context_url varchar(1024) not null, context_title varchar(255) not null); \
create unique index dash_context_idx on dash_context (context_id)

create.NewsItem.table = create table dash_news_item ( id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY, news_time timestamp(6) not null, \
news_time_label_key varchar(40), title varchar(255) not null, entity_ref varchar(265) not null, entity_type bigint not null, subtype varchar(40), \
context_id bigint not null, grouping_id varchar(90)); \
create index dash_news_time_idx on dash_news_item (news_time); \
create index dash_news_grouping_idx on dash_news_item (grouping_id); \
create unique index dash_news_entity_idx on dash_news_item (entity_ref)

create.NewsLink.table = create table dash_news_link ( id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY, person_id bigint not null, \
context_id bigint not null, item_id bigint not null, hidden bit default 0, sticky bit default 0, \
unique (person_id, context_id, item_id)); \
create index dash_news_link_idx on dash_news_link (person_id, context_id, item_id, hidden, sticky)

create.Person.table = create table dash_person ( id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY,user_id varchar(99) not null,\
sakai_id varchar(99)); \
create unique index dash_person_user_id_idx on dash_person (user_id); \
create unique index dash_person_sakai_id_idx on dash_person (sakai_id)

create.PersonContext.table = create table dash_person_context (id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY, \
item_type integer not null, person_id bigint not null, context_id bigint not null); \
create unique index dash_person_context_idx on dash_person_context (item_type, person_id, context_id);

create.PersonContextSourceType.table = create table dash_person_context_type (id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY, \
item_type integer not null, person_id bigint not null, context_id bigint not null, sourcetype_id bigint not null); \
create unique index dash_person_context_type_idx on dash_person_context_type (item_type, person_id, context_id, sourcetype_id);

create.PersonSourceType.table = create table dash_person_sourcetype (id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY, \
item_type integer not null, person_id bigint not null, sourcetype_id bigint not null); \
create unique index dash_person_sourcetype_idx on dash_person_sourcetype (item_type, person_id, sourcetype_id);

create.RepeatingEvent.table = create table dash_repeating_event (id bigint GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY, \
first_time timestamp(6) not null, last_time timestamp(6), frequency varchar(40) not null, max_count integer, \
calendar_time_label_key varchar(40), title varchar(255) not null, \
entity_ref varchar(265) not null, subtype varchar(40), entity_type bigint not null, context_id bigint not null ); \
create index dash_repeating_event_first_idx on dash_repeating_event (first_time); \
create index dash_repeating_event_last_idx on dash_repeating_event (last_time);

create.SourceType.table = create table dash_sourcetype ( id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY, identifier varchar(255) not null, \
access_permission varchar(255)); \
create unique index dash_source_idx on dash_sourcetype (identifier)

delete.AvailabilityChecks.before.date = delete from dash_availability_check where scheduled_time < ?

delete.AvailabilityChecks.by.entityReference = delete from dash_availability_check where entity_ref = ?

delete.CalendarItem.by.id = delete from dash_calendar_item where id=?

delete.CalendarLink.by.personId.itemId = delete from dash_calendar_link where person_id=? and item_id=?

delete.CalendarLinks.by.itemId = delete from dash_calendar_link where item_id=?

delete.CalendarLinks.by.person.context = delete from dash_calendar_link where person_id=? and context_id=?

delete.NewsItem.by.id = delete from dash_news_item where id=?

delete.NewsLink.by.personId.itemId = delete from dash_news_link where person_id=? and item_id=?

delete.NewsLinks.by.itemId = delete from dash_news_link where item_id=?

delete.NewsLinks.by.person.context = delete from dash_news_link where person_id=? and context_id=?

exists.CalendarItem.by.id = select * from dash_calendar_item where id=?

exists.CalendarItem.by.entityReference = select * from dash_calendar_item where entity_ref=?

insert.AvailabilityCheck = insert into dash_availability_check (id, entity_ref, entity_type_id, scheduled_time) \
values (NULL, ?, ?, ?)

insert.CalendarItem = insert into dash_calendar_item (id, calendar_time, calendar_time_label_key, title , entity_ref, subtype, entity_type, context_id) \
values (NULL, ?, ?, ?, ?, ?, ?, ?)

insert.CalendarItem.repeats = insert into dash_calendar_item (id, calendar_time, calendar_time_label_key, title , entity_ref, subtype, entity_type, context_id, repeating_event_id, sequence_num) \
values (NULL, ?, ?, ?, ?, ?, ?, ?, ?, ?)

insert.CalendarLink = insert into dash_calendar_link (id, person_id, item_id, context_id, hidden, sticky) values \
(NULL, ?, ?, ?, ?, ?)

insert.Context = insert into dash_context (id, context_id, context_url, context_title) values (NULL, ?, ?, ?)

insert.NewsItem = insert into dash_news_item (id, news_time, title, news_time_label_key, entity_ref, subtype, entity_type, context_id, grouping_id) \
values (NULL, ?, ?, ?, ?, ?, ?, ?, ?)

insert.NewsLink = insert into dash_news_link (id, person_id, item_id, context_id, hidden, sticky) values (NULL, ?, ?, ?, ?, ?)

insert.Person = insert into dash_person (id, user_id,sakai_id) values (NULL, ?, ?)

insert.PersonContext = insert into dash_person_context (id, item_type, person_id, context_id) values (NULL, ?, ?, ?)

insert.PersonContextSourceType = insert into dash_person_context_type (id, item_type, person_id, context_id, sourcetype_id) values (NULL, ?, ?, ?, ?)

insert.PersonSourceType = insert into dash_person_sourcetype (id, item_type, person_id, sourcetype_id) values (NULL, ?, ?, ?)

insert.RepeatingEvent = insert into dash_repeating_event (id, first_time, last_time, frequency, max_count, \
calendar_time_label_key, title, entity_ref, subtype, entity_type, context_id) values (NULL, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) 

insert.SourceType = insert into dash_sourcetype (id, identifier, access_permission) values (NULL, ?, ?)

select.AvailabilityChecks.before.date = select * from dash_availability_check where scheduled_time < ?

select.AvailabilityChecks.by.entityReference = select * from dash_availability_check where entity_ref = ?

select.CalendarItem.by.entityReference.calendarTimeLabelKey = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, ci.subtype as ci_subtype,  ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \ 
from dash_calendar_item ci join dash_context site on site.id=ci.context_id  \
join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where ci.entity_ref=? and ci.calendar_time_label_key=?

select.CalendarItem.by.entityReference.calendarTimeLabelKey.sequenceNumber = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, ci.subtype as ci_subtype,  ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_item ci join dash_context site on site.id=ci.context_id  \
join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where ci.entity_ref=? and ci.calendar_time_label_key=? and ci.sequence_num=?

select.CalendarItem.by.id = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, ci.subtype as ci_subtype,  ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_item ci join dash_context site on site.id=ci.context_id  \
join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id where ci.id=?

select.CalendarItems.by.contextId = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, ci.subtype as ci_subtype,  ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, \
st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_item ci join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type \
join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where site.context_id=? 

select.CalendarItems.by.entityReference = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, ci.subtype as ci_subtype,  ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \
from dash_calendar_item ci join dash_context site on site.id=ci.context_id  \
join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id where ci.entity_ref=?

select.CalendarItems.by.sakaiId = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, ci.subtype as ci_subtype,  ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \ 
from dash_person usr join dash_calendar_link link on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where usr.sakai_id=? order by ci.calendar_time asc

select.CalendarItems.by.sakaiId.contextId = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, ci.subtype as ci_subtype,  ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype \ 
from dash_person usr join dash_calendar_link link on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where usr.sakai_id=? and site.context_id=? order by ci.calendar_time asc

select.CalendarLink.by.calendarItemId.personId = select ci.id as ci_id, ci.calendar_time as ci_calendar_time, \
ci.calendar_time_label_key as ci_calendar_time_label_key, ci.title as ci_title, ci.entity_ref as ci_entity_ref, ci.subtype as ci_subtype,  ci.sequence_num as ci_sequence_num, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, rep.frequency as rep_frequency, rep.max_count as rep_count, \
rep.calendar_time_label_key as rep_calendar_time_label_key, rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype, \  
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky \
from dash_calendar_link link join dash_person usr on usr.id=link.person_id join dash_calendar_item ci on ci.id=link.item_id \
join dash_context site on site.id=ci.context_id join dash_sourcetype st on st.id=ci.entity_type left join dash_repeating_event rep on ci.repeating_event_id=rep.id \
where link.item_id=? and link.person_id=?

select.Context.by.id = select site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title from dash_context site where site.id=?

select.Context.by.contextId = select site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title from dash_context site where site.context_id=?

select.NewsItem.by.entityReference = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, ni.news_time_label_key as ni_news_time_label_key, \
ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title \
from dash_news_item ni join dash_context site on site.id=ni.context_id  \
join dash_sourcetype st on st.id=ni.entity_type where ni.entity_ref=?

select.NewsItem.by.id = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, ni.news_time_label_key as ni_news_time_label_key, \
ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title \
from dash_news_item ni join dash_context site on site.id=ni.context_id  \
join dash_sourcetype st on st.id=ni.entity_type where ni.id=?

select.NewsItems.sakaiId.collapseCount = (select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, \
ni.news_time_label_key as ni_news_time_label_key, ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, ni.grouping_id as ni_group, 1 as ni_count, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, \
site.id as site_id, site.context_id as site_context_id,  site.context_url as site_context_url, site.context_title as site_context_title,nl.sticky as ni_sticky \
from (select t4.gr_id as gr_id from (select dni.grouping_id as gr_id,count(*) as gr_ct from dash_person dp join dash_news_link dnl on dp.id=dnl.person_id \
join dash_news_item dni on dni.id=dnl.item_id \
where dp.sakai_id=? group by dni.grouping_id) t4 where t4.gr_ct <= ?) t5 \
join dash_news_item ni on ni.grouping_id=t5.gr_id join dash_context site on site.id=ni.context_id \
join dash_sourcetype st on st.id=ni.entity_type join dash_news_link nl on ni.id=nl.item_id \
join dash_person usr on usr.id=nl.person_id where usr.sakai_id=?) \
union \
(select  0 as ni_id, t5.g_time as ni_news_time, '' as ni_title, \
'' as ni_news_time_label_key, ni.grouping_id as ni_entity_ref, '' as ni_subtype, t5.g_id as ni_group, t5.g_count as ni_count, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, \
site.id as site_id, site.context_id as site_context_id,  site.context_url as site_context_url, site.context_title as site_context_title, '0' as ni_sticky \
from (select t4.x as g_id,t4.y as g_count,t4.z as g_time from (select dni.grouping_id as x,count(*) as y,max(dni.news_time) as z \
from dash_person dp join dash_news_link dnl on dp.id=dnl.person_id join dash_news_item dni on dni.id=dnl.item_id join dash_context dc on dnl.context_id=dc.id \
where dp.sakai_id=? and dnl.hidden='0' group by grouping_id) t4 where t4.y > ?) t5 \
join dash_news_item ni on ni.grouping_id=t5.g_id \
join dash_context site on site.id=ni.context_id \
join dash_sourcetype st on st.id=ni.entity_type) \
order by ni_news_time desc

select.NewsItems.sakaiId.contextId.collapseCount = (select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, \
ni.news_time_label_key as ni_news_time_label_key, ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, ni.grouping_id as ni_group, 1 as ni_count, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, \
site.id as site_id, site.context_id as site_context_id,  site.context_url as site_context_url, site.context_title as site_context_title,nl.sticky as ni_sticky \
from (select t4.gr_id as gr_id from (select dni.grouping_id as gr_id,count(*) as gr_ct from dash_person dp join dash_news_link dnl on dp.id=dnl.person_id \
join dash_news_item dni on dni.id=dnl.item_id join dash_context dc on dnl.context_id=dc.id \
where dp.sakai_id=? and dc.context_id=? group by dni.grouping_id) t4 where t4.gr_ct <= ?) t5 \
join dash_news_item ni on ni.grouping_id=t5.gr_id join dash_context site on site.id=ni.context_id \
join dash_sourcetype st on st.id=ni.entity_type join dash_news_link nl on ni.id=nl.item_id \
join dash_person usr on usr.id=nl.person_id where usr.sakai_id=?) \
union \
(select  0 as ni_id, t5.g_time as ni_news_time, '' as ni_title, \
'' as ni_news_time_label_key, ni.grouping_id as ni_entity_ref, '' as ni_subtype, t5.g_id as ni_group, t5.g_count as ni_count, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, \
site.id as site_id, site.context_id as site_context_id,  site.context_url as site_context_url, site.context_title as site_context_title, '0' as ni_sticky \
from (select t4.x as g_id,t4.y as g_count,t4.z as g_time from (select dni.grouping_id as x,count(*) as y,max(dni.news_time) as z \
from dash_person dp join dash_news_link dnl on dp.id=dnl.person_id join dash_news_item dni on dni.id=dnl.item_id join dash_context dc on dnl.context_id=dc.id \
where dp.sakai_id=? and dc.context_id=? and dnl.hidden='0' group by grouping_id) t4 where t4.y > ?) t5 \
join dash_news_item ni on ni.grouping_id=t5.g_id \
join dash_context site on site.id=ni.context_id \
join dash_sourcetype st on st.id=ni.entity_type) \
order by ni_news_time desc

select.NewsItems.by.contextId = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, ni.news_time_label_key as ni_news_time_label_key, \
ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, st.id as type_id, st.identifier as type_identifier, \
st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title \
from dash_news_item ni join dash_context site on site.id=ni.context_id join dash_sourcetype st on st.id=ni.entity_type \
where site.context_id=? \


select.NewsItems.by.sakaiId = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, ni.news_time_label_key as ni_news_time_label_key, \
ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, st.id as type_id, st.identifier as type_identifier, \
st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title \
from dash_person usr join dash_news_link link on usr.id=link.person_id join dash_news_item ni on ni.id=link.item_id \
join dash_context site on site.id=ni.context_id join dash_sourcetype st on st.id=ni.entity_type \
where usr.sakai_id=? order by ni.news_time desc

select.NewsItems.by.sakaiId.contextId = select ni.id as ni_id, ni.news_time as ni_news_time, ni.title as ni_title, ni.news_time_label_key as ni_news_time_label_key, \
ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, st.id as type_id, st.identifier as type_identifier, \
st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title \
from dash_person usr join dash_news_link link on usr.id=link.person_id join dash_news_item ni on ni.id=link.item_id \
join dash_context site on site.id=ni.context_id join dash_sourcetype st on st.id=ni.entity_type \
where usr.sakai_id=? and site.context_id=? order by ni.news_time desc

select.NewsLink.by.newsItemId.personId = select ni.id as ni_id, ni.news_time as ni_news_time, ni.news_time_label_key as ni_news_time_label_key, ni.title as ni_title, ni.news_time_label_key as ni_news_time_label_key, \
ni.entity_ref as ni_entity_ref, ni.subtype as ni_subtype, st.id as type_id, st.identifier as type_identifier, \
st.access_permission as type_accessPermission, site.id as site_id, site.context_id as site_context_id,  \
site.context_url as site_context_url, site.context_title as site_context_title, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id,  \
link.id as link_id, link.hidden as link_hidden, link.sticky as link_sticky \
from dash_news_link link join dash_person usr on usr.id=link.person_id join dash_news_item ni on ni.id=link.item_id \
join dash_context site on site.id=ni.context_id join dash_sourcetype st on st.id=ni.entity_type \
where link.item_id=? and link.person_id=?

select.Person.by.id = select id as p_id, sakai_id as p_sakai_id, user_id as p_user_id from dash_person where id=?

select.Person.by.userId = select id as p_id, sakai_id as p_sakai_id, user_id as p_user_id from dash_person where user_id=?

select.Person.by.sakaiId = select id as p_id, sakai_id as p_sakai_id, user_id as p_user_id from dash_person where sakai_id=?

select.PersonContext.by.sakaiUserId = select pcst.id as pc_id, pcst.item_type as pc_itemtype, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id, \
site.id as site_id, site.context_id as site_context_id, site.context_url as site_context_url, site.context_title as site_context_title \
from dash_person usr join dash_person_sourcetype pcst join on usr.id=pcst.person_id \
join dash_context site on pcst.context_id=site.id \
where usr.sakai_id=?

select.PersonContextSourceType.by.sakaiUserId = select pcst.id as pc_id, pcst.item_type as pc_itemtype, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id, \
site.id as site_id, site.context_id as site_context_id, site.context_url as site_context_url, site.context_title as site_context_title, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission \
from dash_person usr join dash_person_sourcetype pcst join on usr.id=pcst.person_id \
join dash_context site on pcst.context_id=site.id join dash_sourcetype st on pcst.sourcetype_id=st.id \
where usr.sakai_id=?

select.PersonSourceType.by.sakaiUserId = select pcst.id as pc_id, pcst.item_type as pc_itemtype, \
usr.id as p_id, usr.sakai_id as p_sakai_id, usr.user_id as p_user_id, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission \
from dash_person usr join dash_person_sourcetype pcst join on usr.id=pcst.person_id \
join dash_sourcetype st on pcst.sourcetype_id=st.id \
where usr.sakai_id=?

select.sakaiUserIds.in.calendarLinks.by.entityReference = select person.sakai_id from dash_person person \
join dash_calendar_link link on link.person_id=person.id join dash_calendar_item item on link.item_id=item.id \
where item.entity_ref=?  

select.sakaiUserIds.in.newsLinks.by.entityReference = select person.sakai_id from dash_person person \
join dash_news_link link on link.person_id=person.id join dash_news_item item on link.item_id=item.id \
where item.entity_ref=?  

select.RepeatingCalendarItem.by.entityReference.calendarTimeLabelKey = select rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, \
rep.frequency as rep_frequency, rep.max_count as rep_count, rep.calendar_time_label_key as rep_calendar_time_label_key, \
rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, \
site.id as site_id, site.context_id as site_context_id,  site.context_url as site_context_url, site.context_title as site_context_title \
from dash_repeating_event rep join dash_context site on site.id=rep.context_id join dash_sourcetype st on st.id=rep.entity_type \
where rep.entity_ref = ? and rep.calendar_time_label_key = ?

select.RepeatingEvents = select rep.id as rep_id, rep.first_time as rep_first_time, rep.last_time as rep_last_time, \
rep.frequency as rep_frequency, rep.max_count as rep_count, rep.calendar_time_label_key as rep_calendar_time_label_key, \
rep.title as rep_title, rep.entity_ref as rep_entity_ref, rep.subtype as rep_subtype, \
st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission, \
site.id as site_id, site.context_id as site_context_id,  site.context_url as site_context_url, site.context_title as site_context_title \
from dash_repeating_event rep join dash_context site on site.id=rep.context_id join dash_sourcetype st on st.id=rep.entity_type \
order by rep.calendar_time asc

select.SourceType.by.id = select st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission \
from dash_sourcetype st where id=?

select.SourceType.by.identifier = select st.id as type_id, st.identifier as type_identifier, st.access_permission as type_accessPermission \
from dash_sourcetype st where identifier=?

update.CalendarItem.calendarTime = update dash_calendar_item set calendar_time=? where id=?

update.CalendarItem.subtype = update dash_calendar_item set subtype=? where id=?

update.CalendarItem.title = update dash_calendar_item set title=? where id=?

update.CalendarItem.title.calendarTime = update dash_calendar_item set title=?, calendar_time=? where id=?

update.CalendarLink = update dash_calendar_link set person_id=?, item_id=?, context_id=?, hidden=?, sticky=?  where id=?

update.Context.title = update dash_context set context_title=? where context_id=?

update.NewsItem.newsTime = update dash_news_item set news_time=? where id=?

update.NewsItem.newsTimeLabelKey = update dash_news_item set news_time_label_key=? where id=?

update.NewsItem.subtype = update dash_news_item set subtype=? where id=?

update.NewsItem.title = update dash_news_item set title=? where id=?

update.NewsLink = update dash_news_link set person_id=?, item_id=?, context_id=?, hidden=?, sticky=?  where id=?

update.RepeatingEventsLabelKey.entityReference.oldLabelKey = update dash_repeating_event set calendar_time_label_key=? where entity_ref=? and calendar_time_label_key=?

update.RepeatingEventsSubtype.entityReference.labelKey = update dash_repeating_event set subtype=? where entity_ref=? and calendar_time_label_key=?
